container_commands:
  000_cloneS3cmd:
    command: git clone https://github.com/s3tools/s3cmd.git /home/ec2-user/s3cmd && git --git-dir=/home/ec2-user/s3cmd/.git checkout 9ee3bdd320c8
    leader_only: true
  010a_writeConfigKey:
    command: sed -i "s/AWS_SECRET_KEY/$AWS_SECRET_KEY/" .s3cfg
    leader_only: true
  010b_writeConfigSecret:
    command: sed -i "s/AWS_ACCESS_KEY_ID/$AWS_ACCESS_KEY_ID/" .s3cfg
    leader_only: true
  020_gzip:
    command: gzip -r --best compiledPublic
    leader_only: true
  030_rename:
    command: find compiledPublic -type f -name '*.gz' | while read filename; do mv -v "${filename}" "`echo "${filename}" | sed -e 's/\.gz$//'`"; done
    leader_only: true
  040_s3_upload_stylesheets:
    command: /home/ec2-user/s3cmd/s3cmd put -r compiledPublic/stylesheets s3://ateliesStatic/ --acl-public --add-header "Content-Encoding:gzip" --config .s3cfg
    leader_only: true
  050_s3_upload_js:
    command: /home/ec2-user/s3cmd/s3cmd put -r compiledPublic/javascripts s3://ateliesStatic/ --acl-public --add-header "Content-Encoding:gzip" --config .s3cfg
    leader_only: true
  060_s3_upload_images:
    command: /home/ec2-user/s3cmd/s3cmd put -r compiledPublic/images s3://ateliesStatic/ --acl-public --add-header "Content-Encoding:gzip" --config .s3cfg
    leader_only: true
  070_s3_upload_fonts:
    command: /home/ec2-user/s3cmd/s3cmd put -r compiledPublic/fonts s3://ateliesStatic/ --acl-public --add-header "Content-Encoding:gzip" --config .s3cfg
    leader_only: true
